#!/bin/bash

echo "๐ ะะฐะฟััะบ ะปะพะบะฐะปัะฝะพะน ััะตะดั ัะฐะทัะฐะฑะพัะบะธ..."

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ production ะบะพะฝัะตะนะฝะตัั ะตัะปะธ ะพะฝะธ ะทะฐะฟััะตะฝั
echo "โน๏ธ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ production ะบะพะฝัะตะนะฝะตัั..."
docker-compose -f docker-compose.prod.yml down 2>/dev/null || true

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะปะพะบะฐะปัะฝัะต ะบะพะฝัะตะนะฝะตัั
echo "โน๏ธ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะปะพะบะฐะปัะฝัะต ะบะพะฝัะตะนะฝะตัั..."
docker-compose down

# ะฃะดะฐะปัะตะผ ััะฐััะต ะพะฑัะฐะทั ะดะปั ัะธััะพะน ัะฑะพัะบะธ
echo "๐๏ธ ะฃะดะฐะปัะตะผ ััะฐััะต ะพะฑัะฐะทั..."
docker rmi $(docker images | grep birdwatching | awk '{print $3}') 2>/dev/null || true

# ะะฐะฟััะบะฐะตะผ ะปะพะบะฐะปัะฝัั ััะตะดั
echo "๐จ ะกะพะฑะธัะฐะตะผ ะธ ะทะฐะฟััะบะฐะตะผ ะปะพะบะฐะปัะฝัั ััะตะดั..."
docker-compose up --build -d

# ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะธัะพะฒ
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะธัะพะฒ..."
sleep 10

# ะัะพะฒะตััะตะผ ััะฐััั
echo "๐ ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ:"
docker-compose ps

echo ""
echo "โ ะะพะบะฐะปัะฝะฐั ััะตะดะฐ ะทะฐะฟััะตะฝะฐ!"
echo "๐ ะคัะพะฝัะตะฝะด: http://localhost:3011"
echo "๐ง ะัะบะตะฝะด: http://localhost:3010"
echo "๐๏ธ PostgreSQL: localhost:3012"
echo "๐ฆ Redis: localhost:3013"
echo ""
echo "๐ API ะดะพะบัะผะตะฝัะฐัะธั: http://localhost:3010/api/docs"

