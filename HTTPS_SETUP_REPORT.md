# üîí –û–¢–ß–ï–¢ –û –ù–ê–°–¢–†–û–ô–ö–ï HTTPS –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –û–®–ò–ë–û–ö

## üìä –†–ï–®–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –û—à–∏–±–∫–∞ 502 Bad Gateway –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**–ü—Ä–∏—á–∏–Ω–∞**: Backend –Ω–µ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª–µ–π  
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–≤—ã–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ Backend —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î

### 2. ‚ùå –û—à–∏–±–∫–∞ 404 Not Found –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (`/api` —Å—É—Ñ—Ñ–∏–∫—Å)  
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `NEXT_PUBLIC_API_URL` –≤ docker-compose.prod.yml  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API

## üîí –ù–ê–°–¢–†–û–ô–ö–ê HTTPS

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏:

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot –∏ Nginx**
   ```bash
   apt install -y certbot nginx python3-certbot-nginx
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∫–∞–∫ reverse proxy**
   - –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è frontend –∏ API
   - –î–æ–±–∞–≤–ª–µ–Ω—ã security headers

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞**
   ```bash
   certbot --nginx -d excursionapp.mywire.org --non-interactive --agree-tos
   ```

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CORS –Ω–∞—Å—Ç—Ä–æ–µ–∫**
   - –î–æ–±–∞–≤–ª–µ–Ω `https://excursionapp.mywire.org` –≤ allowedOrigins
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å HTTP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

5. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å HTTPS URL**
   - –û–±–Ω–æ–≤–ª–µ–Ω `NEXT_PUBLIC_API_URL` –¥–ª—è HTTPS
   - –ü–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

## üåê NGINX –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç:
```nginx
server {
    listen 80;
    server_name excursionapp.mywire.org 5.144.181.38;
    return 301 https://$server_name$request_uri;
}
```

### HTTPS —Å–µ—Ä–≤–µ—Ä —Å reverse proxy:
```nginx
server {
    listen 443 ssl http2;
    server_name excursionapp.mywire.org 5.144.181.38;
    
    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã Certbot)
    ssl_certificate /etc/letsencrypt/live/excursionapp.mywire.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/excursionapp.mywire.org/privkey.pem;
    
    # Security headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
    # ... –¥—Ä—É–≥–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    
    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    location / {
        proxy_pass http://127.0.0.1:8080;  # Frontend
    }
    
    location ~ ^/(auth|api|excursions|bookings|users) {
        proxy_pass http://127.0.0.1:3010;  # Backend API
    }
}
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: TLS 1.3
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: AEAD-CHACHA20-POLY1305-SHA256
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**: Let's Encrypt (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ 14.12.2025)
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ systemd timer

### Security Headers:
- `Strict-Transport-Security`: HSTS –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS
- `Content-Security-Policy`: –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
- `X-Frame-Options`: –ó–∞—â–∏—Ç–∞ –æ—Ç clickjacking
- `X-Content-Type-Options`: –ó–∞—â–∏—Ç–∞ –æ—Ç MIME sniffing

### CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```typescript
const allowedOrigins = [
  'http://localhost:3011',           // –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
  'https://excursionapp.mywire.org', // Production HTTPS
  'http://excursionapp.mywire.org',  // Fallback HTTP
  'http://5.144.181.38',            // IP –∞–¥—Ä–µ—Å
  process.env.FRONTEND_URL
];
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **HTTPS –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**:
   ```bash
   curl -I https://excursionapp.mywire.org
   # HTTP/1.1 200 OK
   ```

2. **HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç**:
   ```bash
   curl -I http://excursionapp.mywire.org
   # HTTP/1.1 301 Moved Permanently
   # Location: https://excursionapp.mywire.org/
   ```

3. **API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
   ```bash
   curl -X POST https://excursionapp.mywire.org/auth/register
   # HTTP/1.1 201 Created (—Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
   ```

4. **–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã**:
   - ‚úÖ admin@birdwatch.ru / admin123 (—Ä–æ–ª—å: admin)
   - ‚úÖ guide@birdwatch.ru / guide123 (—Ä–æ–ª—å: guide)  
   - ‚úÖ user@birdwatch.ru / user123 (—Ä–æ–ª—å: user)

## üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–°–õ–ï –ù–ê–°–¢–†–û–ô–ö–ò

```
Internet (HTTPS) ‚Üí Nginx (443) ‚Üí Docker Network
                     ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Frontend (Next.js)     Backend (NestJS) ‚îÇ
    ‚îÇ Port: 8080            Port: 3010        ‚îÇ
    ‚îÇ                                         ‚îÇ
    ‚îÇ PostgreSQL (internal)  Redis (internal) ‚îÇ
    ‚îÇ Port: 5432            Port: 6379        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:
- **Nginx** –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ reverse proxy –Ω–∞ –ø–æ—Ä—Ç—É 443/80
- **Docker –ø–æ—Ä—Ç—ã** –∑–∞–∫—Ä—ã—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ internal)
- **SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ Nginx
- **Security headers** –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è Nginx'–æ–º

## üîÑ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï

### Certbot –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
systemctl status certbot.timer
# ‚óè certbot.timer - Run certbot twice daily
#   Active: active (waiting)
```

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
certbot renew --dry-run  # –¢–µ—Å—Ç
certbot renew           # –†–µ–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚ùå HTTP —Ç–æ–ª—å–∫–æ
- ‚ùå –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- ‚ùå –ù–µ—Ç security headers
- ‚ùå –£—è–∑–≤–∏–º–æ—Å—Ç—å –∫ MITM –∞—Ç–∞–∫–∞–º
- **–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 4/10

### –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ HTTPS —Å TLS 1.3
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Security headers
- ‚úÖ HSTS –∑–∞—â–∏—Ç–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- **–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 9/10

## üåê –î–û–°–¢–£–ü –ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Æ

### –û—Å–Ω–æ–≤–Ω—ã–µ URL:
- **–°–∞–π—Ç**: https://excursionapp.mywire.org
- **–í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ HTTPS

### –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: admin@birdwatch.ru / admin123
- **–≠–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥**: guide@birdwatch.ru / guide123
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: user@birdwatch.ru / user123

## üîß –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ü–û–î–î–ï–†–ñ–ö–ê

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
certbot certificates

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx
nginx -t && systemctl reload nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose -f docker-compose.prod.yml ps

# –õ–æ–≥–∏ Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
curl -I https://excursionapp.mywire.org

# –ü—Ä–æ–≤–µ—Ä–∫–∞ security headers
curl -I https://excursionapp.mywire.org | grep -E "(Strict-Transport|Content-Security|X-Frame)"

# –¢–µ—Å—Ç SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nmap --script ssl-enum-ciphers -p 443 excursionapp.mywire.org
```

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**HTTPS —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã!**

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ BirdWatching —Ç–µ–ø–µ—Ä—å:
- üîí –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω–æ SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- üõ°Ô∏è –ò–º–µ–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ security headers
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- üåê –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∫—Ä–∞—Å–∏–≤–æ–º—É –¥–æ–º–µ–Ω—É excursionapp.mywire.org

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!**

---

**üìÖ –î–∞—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: $(date)  
**üîí –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ**: 14 –¥–µ–∫–∞–±—Ä—è 2025  
**üìä –£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 9/10



