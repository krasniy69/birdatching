#!/bin/bash

# –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ CORS –ø—Ä–æ–±–ª–µ–º—ã

SERVER_IP="5.144.181.38"

echo "üîç –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê CORS –ü–†–û–ë–õ–ï–ú–´"
echo "======================================="

echo ""
echo "1. üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º OPTIONS –∑–∞–ø—Ä–æ—Å (preflight):"
echo "-------------------------------------------"
curl -X OPTIONS http://5.144.181.38:3010/auth/login \
  -H "Origin: http://5.144.181.38:8080" \
  -H "Access-Control-Request-Method: POST" \
  -H "Access-Control-Request-Headers: Content-Type" \
  -v 2>&1 | head -20

echo ""
echo "2. üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º POST –∑–∞–ø—Ä–æ—Å —Å CORS –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:"
echo "-----------------------------------------------"
curl -X POST http://5.144.181.38:3010/auth/login \
  -H "Content-Type: application/json" \
  -H "Origin: http://5.144.181.38:8080" \
  -d '{"email":"admin@birdwatch.ru","password":"admin123"}' \
  -v 2>&1 | head -15

echo ""
echo "3. üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å:"
echo "--------------------------------------------------------"
curl -X GET http://5.144.181.38:3010/ \
  -H "Origin: http://5.144.181.38:8080" \
  -v 2>&1 | head -10

echo ""
echo "4. üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:"
echo "--------------------------------------"
curl -I http://5.144.181.38:8080 2>&1 | head -5

echo ""
echo "5. üìã –°–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:"
echo "-----------------------------------"
ssh root@5.144.181.38 'cd /opt/birdwatching && docker-compose -f docker-compose.prod.yml logs backend --tail=15' 2>/dev/null || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH"

echo ""
echo "6. üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±—ç–∫–µ–Ω–¥–∞:"
echo "----------------------------------------------------------"
ssh root@5.144.181.38 'cd /opt/birdwatching && docker-compose -f docker-compose.prod.yml exec backend printenv | grep -E "(CORS|FRONTEND|NODE_ENV)"' 2>/dev/null || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH"

echo ""
echo "========================================="
echo "üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –î–ê–õ–¨–ù–ï–ô–®–ï–ô –û–¢–õ–ê–î–ö–ò:"
echo "========================================="
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools –≤ –±—Ä–∞—É–∑–µ—Ä–µ (F12)"
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Network"
echo "3. –û—á–∏—Å—Ç–∏—Ç–µ –ª–æ–≥–∏ (Clear)"
echo "4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É"
echo "5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ /auth/login"
echo "6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "   - –ï—Å—Ç—å –ª–∏ OPTIONS –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ POST?"
echo "   - –ö–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ OPTIONS?"
echo "   - –ö–∞–∫–∞—è –æ—à–∏–±–∫–∞ –≤ POST –∑–∞–ø—Ä–æ—Å–µ?"
echo ""
echo "üîó –°—Å—ã–ª–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "  –§—Ä–æ–Ω—Ç–µ–Ω–¥: http://5.144.181.38:8080"
echo "  API Docs: http://5.144.181.38:3010/api/docs"



